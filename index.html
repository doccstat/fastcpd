<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Implements fast change point detection algorithm based on the
    paper &quot;Sequential Gradient Descent and Quasi-Newton's Method for
    Change-Point Analysis&quot; by Xianyang Zhang, Trisha Dawn
    &lt;https://proceedings.mlr.press/v206/zhang23b.html&gt;. The algorithm is
    based on dynamic programming with pruning and sequential gradient
    descent. It is able to detect change points a magnitude faster than
    the vanilla Pruned Exact Linear Time(PELT). The package includes
    examples of linear regression, logistic regression, Poisson
    regression, penalized linear regression data, and whole lot more
    examples with custom cost function in case the user wants to use their
    own cost function.">
<title>Fast Change Point Detection via Sequential Gradient Descent • fastcpd</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Source_Sans_Pro-0.4.8/font.css" rel="stylesheet">
<link href="deps/Source_Code_Pro-0.4.8/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Fast Change Point Detection via Sequential Gradient Descent">
<meta property="og:description" content="Implements fast change point detection algorithm based on the
    paper &quot;Sequential Gradient Descent and Quasi-Newton's Method for
    Change-Point Analysis&quot; by Xianyang Zhang, Trisha Dawn
    &lt;https://proceedings.mlr.press/v206/zhang23b.html&gt;. The algorithm is
    based on dynamic programming with pruning and sequential gradient
    descent. It is able to detect change points a magnitude faster than
    the vanilla Pruned Exact Linear Time(PELT). The package includes
    examples of linear regression, logistic regression, Poisson
    regression, penalized linear regression data, and whole lot more
    examples with custom cost function in case the user wants to use their
    own cost function.">
<meta property="og:image" content="https://fastcpd.xingchi.li/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">fastcpd</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.10.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/examples-introductory.html">Introductory examples</a>
    <a class="dropdown-item" href="articles/examples-advanced.html">Advanced examples</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Comparison</h6>
    <a class="dropdown-item" href="articles/comparison-pelt.html">Comparison with vanilla PELT</a>
    <a class="dropdown-item" href="articles/comparison-packages.html">Comparison with other R packages</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/doccstat/fastcpd/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.svg" class="logo" alt=""><h1 id="fastcpd-">fastcpd 
<a class="anchor" aria-label="anchor" href="#fastcpd-"></a>
</h1>
</div>
<p><a href="https://cran.r-project.org/package=fastcpd" class="external-link"><img src="https://www.r-pkg.org/badges/version-last-release/fastcpd" alt="CRAN status"></a> <a href="https://cran.r-project.org/package=fastcpd" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/grand-total/fastcpd" alt="Downloads"></a> <a href="https://github.com/doccstat/fastcpd/actions" class="external-link"><img src="https://github.com/doccstat/fastcpd/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a> <a href="https://app.codecov.io/gh/doccstat/fastcpd?branch=main" class="external-link"><img src="https://codecov.io/gh/doccstat/fastcpd/branch/main/graph/badge.svg" alt="Codecov test coverage"></a> <a href="https://github.com/doccstat/fastcpd" class="external-link"><img src="https://img.shields.io/github/last-commit/doccstat/fastcpd" alt="Last Commit"></a> <a href="https://doccstat.r-universe.dev" class="external-link"><img src="https://doccstat.r-universe.dev/badges/fastcpd" alt="r-universe"></a> <a href="https://www.codefactor.io/repository/github/doccstat/fastcpd" class="external-link"><img src="https://www.codefactor.io/repository/github/doccstat/fastcpd/badge" alt="CodeFactor"></a></p>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The fastcpd (<strong>fast</strong> <strong>c</strong>hange <strong>p</strong>oint <strong>d</strong>etection) is a fast implmentation of change point detection methods in R. The <strong>fastcpd</strong> package is designed to find change points in a fast manner. It is easy to install and extensible to all kinds of change point problems with a user specified cost function apart from the built-in cost functions.</p>
<p>To learn more behind the algorithms:</p>
<ul>
<li><a href="https://proceedings.mlr.press/v206/zhang23b.html" class="external-link">Sequential Gradient Descent and Quasi-Newton’s Method for Change-Point Analysis</a></li>
</ul>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install from CRAN</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"fastcpd"</span><span class="op">)</span></span></code></pre></div>
<details close><summary>
Development version
</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Development version from r-universe with CRAN version as a fallback</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span></span>
<span>  <span class="st">"fastcpd"</span>,</span>
<span>  repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"https://doccstat.r-universe.dev"</span>, <span class="st">"https://cloud.r-project.org"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"doccstat/fastcpd"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"doccstat/fastcpd"</span><span class="op">)</span></span></code></pre></div>
</details><details close><summary>
With mamba or conda (available soon)
</summary><div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># conda-forge is a fork from CRAN and may not be up-to-date</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Use mamba</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="ex">mamba</span> install r-fastcpd</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Use conda</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> install <span class="at">-c</span> conda-forge r-fastcpd</span></code></pre></div>
</details><div class="section level3">
<h3 id="faq">FAQ<a class="anchor" aria-label="anchor" href="#faq"></a>
</h3>
<details close><summary>
Package dependencies
</summary><p><code>fastcpd</code> depends on the following packages:</p>
<ul>
<li>
<a href="https://github.com/RcppCore/Rcpp" class="external-link">Rcpp</a>, for C++ source code compilation.</li>
<li>
<a href="https://github.com/RcppCore/RcppArmadillo" class="external-link">RcppArmadillo</a>, for fast linear algebra.</li>
<li>
<a href="https://github.com/jaredhuling/fastglm" class="external-link">fastglm</a>, for fast generalized linear models.</li>
<li>
<a href="https://glmnet.stanford.edu/" class="external-link">glmnet</a>, for penalized regression.</li>
<li>
<a href="https://github.com/tidyverse/ggplot2" class="external-link">ggplot2</a>, for data visualization.</li>
</ul>
<p>If you’re compiling from source, you can run the following command to see the complete set of system packages needed on your machine.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pkg_sysreqs.html" class="external-link">pkg_sysreqs</a></span><span class="op">(</span><span class="st">"doccstat/fastcpd"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── Install scripts ───────────────────────────────────────────── Ubuntu 20.04</span></span>
<span><span class="co">#&gt; apt-get -y update</span></span>
<span><span class="co">#&gt; apt-get -y install libcurl4-openssl-dev libssl-dev zlib1g-dev make</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; ── Packages and their system dependencies ───────────────────────────────────</span></span>
<span><span class="co">#&gt; curl       – libcurl4-openssl-dev, libssl-dev</span></span>
<span><span class="co">#&gt; data.table – zlib1g-dev</span></span>
<span><span class="co">#&gt; fs         – make</span></span>
<span><span class="co">#&gt; openssl    – libssl-dev</span></span></code></pre></div>
</details><details close><summary>
I countered problems related to gfortran on Mac OSX or Linux!
</summary><p>The package should be able to install on Mac and any Linux distribution without any problems if all the dependencies are installed. However, if you encountered problems related to gfortran, it might be because <code>RcppArmadillo</code> is not installed previously. Try <a href="https://stackoverflow.com/a/72997915" class="external-link">Mac OSX stackoverflow solution</a> or <a href="https://stackoverflow.com/a/15540919" class="external-link">Linux stackover solution</a> if you have trouble installing <code>RcppArmadillo</code>.</p>
</details>
</div>
</div>
<div class="section level2">
<h2 id="cheatsheet">Cheatsheet<a class="anchor" aria-label="anchor" href="#cheatsheet"></a>
</h2>
<p><a href="https://github.com/doccstat/fastcpd/blob/main/man/figures/cheatsheets.pdf" class="external-link"><img src="reference/figures/cheatsheets.png" alt="fastcpd cheatsheet"></a></p>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>It is hard to demonstrate all the features of <code>fastcpd</code> in a single example due to the flexibility of the package. For more examples, please refer to the <a href="https://fastcpd.xingchi.li/reference/index.html">function reference</a>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span> <span class="op">+</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">600</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.6</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">0.1</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">601</span><span class="op">:</span><span class="fl">1000</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.3</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">0.4</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">fastcpd</span><span class="fu">::</span><span class="fu"><a href="reference/fastcpd_ar.html">fastcpd.ar</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">3</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; fastcpd::fastcpd.ar(data = x[3 + seq_len(n)], order = 3)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Change points:</span></span>
<span><span class="co">#&gt; 612 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cost values:</span></span>
<span><span class="co">#&gt; 2748.404 2022.597 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt;     segment 1   segment 2</span></span>
<span><span class="co">#&gt; 1  0.57656238  0.13006290</span></span>
<span><span class="co">#&gt; 2 -0.21582749 -0.03084403</span></span>
<span><span class="co">#&gt; 3  0.07985424 -0.04544551</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-ar3-1.png"><!-- --></p>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<!-- This example section is a direct copy from `fastcpd` documentation -->
<details close><summary>
Click to open
</summary><div class="section level3">
<h3 id="linear-regression-with-one-dimensional-covariate">linear regression with one-dimensional covariate<a class="anchor" aria-label="anchor" href="#linear-regression-with-one-dimensional-covariate"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fastcpd.xingchi.li">fastcpd</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">mvtnorm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html" class="external-link">rmvnorm</a></span><span class="op">(</span><span class="fl">300</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">p</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">theta_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="op">]</span> <span class="op">*</span> <span class="va">theta_0</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fl">101</span><span class="op">:</span><span class="fl">200</span>, <span class="op">]</span> <span class="op">*</span> <span class="va">theta_0</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="va">x</span><span class="op">[</span><span class="fl">201</span><span class="op">:</span><span class="fl">300</span>, <span class="op">]</span> <span class="op">*</span> <span class="va">theta_0</span><span class="op">[</span><span class="fl">3</span>, <span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fastcpd.html">fastcpd</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, x <span class="op">=</span> <span class="va">x</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"lm"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-linear_regression_with_one_dimensional_covariate-1.png"><!-- --></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; fastcpd(formula = y ~ . - 1, data = data.frame(y = y, x = x), </span></span>
<span><span class="co">#&gt;     family = "lm")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Change points:</span></span>
<span><span class="co">#&gt; 99 197 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cost values:</span></span>
<span><span class="co">#&gt; 48.36336 65.71493 46.37389 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt;   segment 1  segment 2 segment 3</span></span>
<span><span class="co">#&gt; 1  0.956995 -0.8488617 0.4562731</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="custom-logistic-regression">custom logistic regression<a class="anchor" aria-label="anchor" href="#custom-logistic-regression"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fastcpd.xingchi.li">fastcpd</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">375</span> <span class="op">*</span> <span class="va">p</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">p</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">p</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">1</span>, <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">200</span>, <span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">175</span>, <span class="fl">1</span>, <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">[</span><span class="fl">201</span><span class="op">:</span><span class="fl">375</span>, <span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">theta</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, x <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="va">result_builtin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="reference/fastcpd.html">fastcpd</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"binomial"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">logistic_loss</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">theta</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">u</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">theta</span></span>
<span>  <span class="va">nll</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">y</span> <span class="op">*</span> <span class="va">u</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">nll</span><span class="op">[</span><span class="va">u</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">y</span><span class="op">[</span><span class="va">u</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">]</span> <span class="op">*</span> <span class="va">u</span><span class="op">[</span><span class="va">u</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">]</span> <span class="op">+</span> <span class="va">u</span><span class="op">[</span><span class="va">u</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">nll</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">logistic_loss_gradient</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">theta</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, <span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">theta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="va">x</span></span>
<span><span class="op">}</span></span>
<span><span class="va">logistic_loss_hessian</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">theta</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">prob</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">theta</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">(</span><span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/outer.html" class="external-link">%o%</a></span> <span class="va">x</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">prob</span><span class="op">)</span> <span class="op">*</span> <span class="va">prob</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">result_custom</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fastcpd.html">fastcpd</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  epsilon <span class="op">=</span> <span class="fl">1e-5</span>,</span>
<span>  cost <span class="op">=</span> <span class="va">logistic_loss</span>,</span>
<span>  cost_gradient <span class="op">=</span> <span class="va">logistic_loss_gradient</span>,</span>
<span>  cost_hessian <span class="op">=</span> <span class="va">logistic_loss_hessian</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>  <span class="st">"Change points detected by built-in logistic regression model: "</span>,</span>
<span>  <span class="va">result_builtin</span><span class="op">@</span><span class="va">cp_set</span>, <span class="st">"\n"</span>,</span>
<span>  <span class="st">"Change points detected by custom logistic regression model: "</span>,</span>
<span>  <span class="va">result_custom</span><span class="op">@</span><span class="va">cp_set</span>, <span class="st">"\n"</span>,</span>
<span>  sep <span class="op">=</span> <span class="st">""</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Change points detected by built-in logistic regression model: 200</span></span>
<span><span class="co">#&gt; Change points detected by custom logistic regression model: 201</span></span>
<span><span class="va">result_custom_two_epochs</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fastcpd.html">fastcpd</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  k <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">1</span>,</span>
<span>  epsilon <span class="op">=</span> <span class="fl">1e-5</span>,</span>
<span>  cost <span class="op">=</span> <span class="va">logistic_loss</span>,</span>
<span>  cost_gradient <span class="op">=</span> <span class="va">logistic_loss_gradient</span>,</span>
<span>  cost_hessian <span class="op">=</span> <span class="va">logistic_loss_hessian</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result_custom_two_epochs</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; fastcpd(formula = y ~ . - 1, data = data, k = function(x) 1, </span></span>
<span><span class="co">#&gt;     epsilon = 1e-05, cost = logistic_loss, cost_gradient = logistic_loss_gradient, </span></span>
<span><span class="co">#&gt;     cost_hessian = logistic_loss_hessian)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Change points:</span></span>
<span><span class="co">#&gt; 200 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt;    segment 1  segment 2</span></span>
<span><span class="co">#&gt; 1 -0.6235240  2.0066479</span></span>
<span><span class="co">#&gt; 2 -1.6767614  1.6278889</span></span>
<span><span class="co">#&gt; 3 -1.7973433  4.6422022</span></span>
<span><span class="co">#&gt; 4 -0.4842969 -0.1521062</span></span>
<span><span class="co">#&gt; 5  2.0797875  2.4047092</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="custom-cost-function-huber-regression">custom cost function huber regression<a class="anchor" aria-label="anchor" href="#custom-cost-function-huber-regression"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fastcpd.xingchi.li">fastcpd</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">400</span> <span class="op">+</span> <span class="fl">300</span> <span class="op">+</span> <span class="fl">500</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">mvtnorm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html" class="external-link">rmvnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">p</span><span class="op">)</span>, sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu">mvtnorm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html" class="external-link">rmvnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">p</span> <span class="op">-</span> <span class="fl">3</span><span class="op">)</span>, sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">p</span> <span class="op">-</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu">mvtnorm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html" class="external-link">rmvnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">5</span>, <span class="va">p</span> <span class="op">-</span> <span class="fl">3</span><span class="op">)</span>, sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">p</span> <span class="op">-</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu">mvtnorm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html" class="external-link">rmvnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">9</span>, <span class="va">p</span> <span class="op">-</span> <span class="fl">3</span><span class="op">)</span>, sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">p</span> <span class="op">-</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">theta</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">400</span>, <span class="fl">300</span>, <span class="fl">500</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">y_true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">x</span> <span class="op">*</span> <span class="va">theta</span><span class="op">)</span></span>
<span><span class="va">factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fl">2</span> <span class="op">*</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">400</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  <span class="fl">2</span> <span class="op">*</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">300</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  <span class="fl">2</span> <span class="op">*</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">500</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">factor</span> <span class="op">*</span> <span class="va">y_true</span> <span class="op">+</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind.data.frame</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">x</span><span class="op">)</span></span>
<span><span class="va">huber_threshold</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">huber_loss</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">theta</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">residual</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">data</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">theta</span></span>
<span>  <span class="va">indicator</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">residual</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">huber_threshold</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span></span>
<span>    <span class="va">residual</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">indicator</span> <span class="op">+</span></span>
<span>      <span class="va">huber_threshold</span> <span class="op">*</span> <span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">residual</span><span class="op">)</span> <span class="op">-</span> <span class="va">huber_threshold</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>      <span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">indicator</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">huber_loss_gradient</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">theta</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">residual</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">theta</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">residual</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">huber_threshold</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="op">-</span><span class="va">residual</span> <span class="op">*</span> <span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="op">-</span><span class="va">huber_threshold</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">residual</span><span class="op">)</span> <span class="op">*</span> <span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">huber_loss_hessian</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">theta</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">residual</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">theta</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">residual</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">huber_threshold</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fl">0.01</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">huber_regression_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fastcpd.html">fastcpd</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  beta <span class="op">=</span> <span class="op">(</span><span class="va">p</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>,</span>
<span>  cost <span class="op">=</span> <span class="va">huber_loss</span>,</span>
<span>  cost_gradient <span class="op">=</span> <span class="va">huber_loss_gradient</span>,</span>
<span>  cost_hessian <span class="op">=</span> <span class="va">huber_loss_hessian</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">huber_regression_result</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; fastcpd(formula = y ~ . - 1, data = data, beta = (p + 1) * log(n)/2, </span></span>
<span><span class="co">#&gt;     cost = huber_loss, cost_gradient = huber_loss_gradient, cost_hessian = huber_loss_hessian)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Change points:</span></span>
<span><span class="co">#&gt; 401 726 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt;     segment 1   segment 2    segment 3</span></span>
<span><span class="co">#&gt; 1 -0.52615415  2.77991463  8.744706508</span></span>
<span><span class="co">#&gt; 2 -1.02443443  5.06390528  9.506534878</span></span>
<span><span class="co">#&gt; 3 -0.09220421  0.01647923 -0.008908851</span></span>
<span><span class="co">#&gt; 4 -0.01326592 -0.08103008 -0.047909865</span></span>
<span><span class="co">#&gt; 5  0.02526703  0.01329142  0.025171681</span></span></code></pre></div>

</div>
</details>
</div>
<div class="section level2">
<h2 id="make-contributions">Make contributions<a class="anchor" aria-label="anchor" href="#make-contributions"></a>
</h2>
<p>We welcome contributions from everyone. Please follow the instructions below to make contributions.</p>
<ol style="list-style-type: decimal">
<li><p>Fork the repo.</p></li>
<li><p>Create a new branch from <code>main</code> branch.</p></li>
<li>
<p>Make changes and commit them.</p>
<ol style="list-style-type: decimal">
<li>Please follow the <a href="https://google.github.io/styleguide/Rguide.html" class="external-link">Google’s R style guide</a> for naming variables and functions.</li>
<li>If you are adding a new family of models with new cost functions with corresponding gradient and Hessian, please add them to <code>src/fastcpd_class_cost.cc</code> with proper example and tests in <code>vignettes/gallery.Rmd</code> and <code>tests/testthat/test-gallery.R</code>.</li>
<li>Add the family name to <code>src/fastcpd_constants.h</code>.</li>
<li>[Recommended] Add a new wrapper function in <code>R/fastcpd_wrappers.R</code> for the new family of models and move the examples to the new wrapper function as roxygen examples.</li>
<li>Add the new wrapper function to the corresponding section in <code>_pkgdown.yml</code>.</li>
</ol>
</li>
<li><p>Push the changes to your fork.</p></li>
<li><p>Create a pull request.</p></li>
<li><p>Make sure the pull request does not create new warnings or errors in <code>devtools::check()</code>.</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="contact-us">Contact us<a class="anchor" aria-label="anchor" href="#contact-us"></a>
</h2>
<p>Encountered a bug or unintended behavior?</p>
<ol style="list-style-type: decimal">
<li>File a ticket at <a href="https://github.com/doccstat/fastcpd/issues" class="external-link">GitHub Issues</a>.</li>
<li>Contact the authors specified in <a href="https://github.com/doccstat/fastcpd/blob/main/DESCRIPTION#L5-L10" class="external-link">DESCRIPTION</a>.</li>
</ol>
</div>
<div class="section level2">
<h2 id="stargazers-over-time">Stargazers over time<a class="anchor" aria-label="anchor" href="#stargazers-over-time"></a>
</h2>
<p><a href="https://starchart.cc/doccstat/fastcpd" class="external-link"><img src="https://starchart.cc/doccstat/fastcpd.svg" alt="Stargazers over time"></a></p>
</div>
<div class="section level2">
<h2 id="codecov-icicle">Codecov Icicle<a class="anchor" aria-label="anchor" href="#codecov-icicle"></a>
</h2>
<p><a href="https://app.codecov.io/gh/doccstat/fastcpd?branch=main" class="external-link"><img src="https://codecov.io/gh/doccstat/fastcpd/graphs/icicle.svg" alt="Codecov Icicle"></a></p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=fastcpd" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/doccstat/fastcpd/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/doccstat/fastcpd/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing fastcpd</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://www.xingchi.li" class="external-link">Xingchi Li</a> <br><small class="roles"> Author, maintainer, copyright holder </small> <a href="https://orcid.org/0009-0006-2493-0853" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>
<a href="https://zhangxiany-tamu.github.io" class="external-link">Xianyang Zhang</a> <br><small class="roles"> Author, copyright holder </small>  </li>
<li>
<a href="mailto:trisha@stat.tamu.edu">Trisha Dawn</a> <br><small class="roles"> Author, copyright holder </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://www.xingchi.li" class="external-link">Xingchi Li</a>, <a href="https://zhangxiany-tamu.github.io" class="external-link">Xianyang Zhang</a>, <a href="mailto:trisha@stat.tamu.edu">Trisha Dawn</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
